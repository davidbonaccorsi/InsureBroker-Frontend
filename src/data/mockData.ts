import { Client, Insurer, InsuranceProduct, Broker, InsurancePolicy, Commission, Renewal, DashboardStats, ActivityLog, Notification, Offer, ProductCustomField } from '@/types';

export const mockClients: Client[] = [
  {
    id: 1,
    firstName: 'John',
    lastName: 'Smith',
    email: 'john.smith@email.com',
    phone: '+40 755-010-101',
    address: '123 Main Street, Bucharest, Romania',
    dateOfBirth: '1985-03-15',
    nationality: 'Romanian',
    cnp: '1850315123456',
    idType: 'ID_CARD',
    idNumber: 'RO123456789',
    idExpiry: '2028-03-15',
    gdprConsent: true,
    gdprConsentDate: '2024-01-15',
    brokerId: 1,
    createdAt: '2024-01-15',
    updatedAt: '2024-01-15',
  },
  {
    id: 2,
    firstName: 'Maria',
    lastName: 'Popescu',
    email: 'maria.p@email.com',
    phone: '+40 755-010-102',
    address: '456 Oak Avenue, Cluj-Napoca, Romania',
    dateOfBirth: '1990-07-22',
    nationality: 'Romanian',
    cnp: '2900722123457',
    idType: 'PASSPORT',
    idNumber: 'P987654321',
    idExpiry: '2030-07-22',
    gdprConsent: true,
    gdprConsentDate: '2024-01-18',
    brokerId: 2,
    createdAt: '2024-01-18',
    updatedAt: '2024-02-10',
  },
  {
    id: 3,
    firstName: 'Andrei',
    lastName: 'Ionescu',
    email: 'a.ionescu@email.com',
    phone: '+40 755-010-103',
    address: '789 Pine Road, Timisoara, Romania',
    dateOfBirth: '1978-11-08',
    nationality: 'Romanian',
    cnp: '1781108123458',
    idType: 'DRIVERS_LICENSE',
    idNumber: 'TM789012345',
    idExpiry: '2026-11-08',
    gdprConsent: true,
    gdprConsentDate: '2024-02-01',
    brokerId: 1,
    createdAt: '2024-02-01',
    updatedAt: '2024-02-01',
  },
  {
    id: 4,
    firstName: 'Elena',
    lastName: 'Dumitrescu',
    email: 'elena.d@email.com',
    phone: '+40 755-010-104',
    address: '321 Elm Street, Iasi, Romania',
    dateOfBirth: '1992-05-30',
    nationality: 'Romanian',
    cnp: '2920530123459',
    idType: 'ID_CARD',
    idNumber: 'IS456789012',
    idExpiry: '2027-05-30',
    gdprConsent: true,
    gdprConsentDate: '2024-02-05',
    brokerId: 3,
    createdAt: '2024-02-05',
    updatedAt: '2024-03-12',
  },
  {
    id: 5,
    firstName: 'Alexandru',
    lastName: 'Gheorghe',
    email: 'alex.g@email.com',
    phone: '+40 755-010-105',
    address: '654 Maple Drive, Constanta, Romania',
    dateOfBirth: '1988-09-14',
    nationality: 'Romanian',
    cnp: '1880914123460',
    idType: 'PASSPORT',
    idNumber: 'P123456789',
    idExpiry: '2029-09-14',
    gdprConsent: true,
    gdprConsentDate: '2024-02-20',
    brokerId: 2,
    createdAt: '2024-02-20',
    updatedAt: '2024-02-20',
  },
];

export const mockInsurers: Insurer[] = [
  {
    id: 1,
    name: 'Allianz-Tiriac',
    code: 'ALT',
    contactEmail: 'partners@allianz-tiriac.ro',
    contactPhone: '+40 21-555-0001',
    address: '100 Victoriei Street, Bucharest, Romania',
    active: true,
    createdAt: '2023-01-01',
  },
  {
    id: 2,
    name: 'Omniasig',
    code: 'OMN',
    contactEmail: 'brokers@omniasig.ro',
    contactPhone: '+40 21-555-0002',
    address: '200 Unirii Blvd, Bucharest, Romania',
    active: true,
    createdAt: '2023-01-15',
  },
  {
    id: 3,
    name: 'Groupama',
    code: 'GRP',
    contactEmail: 'agents@groupama.ro',
    contactPhone: '+40 21-555-0003',
    address: '300 Magheru Blvd, Bucharest, Romania',
    active: true,
    createdAt: '2023-02-01',
  },
  {
    id: 4,
    name: 'Euroins',
    code: 'EUR',
    contactEmail: 'support@euroins.ro',
    contactPhone: '+40 21-555-0004',
    address: '400 Calea Floreasca, Bucharest, Romania',
    active: false,
    createdAt: '2023-03-01',
  },
];

// Custom fields for different product types
const homeInsuranceFields: ProductCustomField[] = [
  {
    id: 'year_built',
    name: 'yearBuilt',
    label: 'Year of Building',
    type: 'number',
    required: true,
    placeholder: '1990',
    factorMultiplier: 1.15,
    factorCondition: 'value < 1980',
  },
  {
    id: 'building_material',
    name: 'buildingMaterial',
    label: 'Building Material',
    type: 'select',
    required: true,
    options: ['Concrete', 'Brick', 'Wood', 'Steel', 'Mixed'],
    factorMultiplier: 1.25,
    factorCondition: 'value === "Wood"',
  },
  {
    id: 'property_address',
    name: 'propertyAddress',
    label: 'Property Address',
    type: 'text',
    required: true,
    placeholder: 'Full property address',
  },
  {
    id: 'floor_area',
    name: 'floorArea',
    label: 'Floor Area (mÂ²)',
    type: 'number',
    required: true,
    placeholder: '100',
  },
  {
    id: 'has_alarm',
    name: 'hasAlarm',
    label: 'Has Security Alarm',
    type: 'checkbox',
    required: false,
    factorMultiplier: 0.9,
    factorCondition: 'value === true',
  },
];

const autoInsuranceFields: ProductCustomField[] = [
  {
    id: 'vehicle_make',
    name: 'vehicleMake',
    label: 'Vehicle Make',
    type: 'text',
    required: true,
    placeholder: 'e.g., Toyota',
  },
  {
    id: 'vehicle_model',
    name: 'vehicleModel',
    label: 'Vehicle Model',
    type: 'text',
    required: true,
    placeholder: 'e.g., Camry',
  },
  {
    id: 'vehicle_year',
    name: 'vehicleYear',
    label: 'Vehicle Year',
    type: 'number',
    required: true,
    placeholder: '2020',
    factorMultiplier: 1.1,
    factorCondition: 'value < 2015',
  },
  {
    id: 'vehicle_vin',
    name: 'vehicleVin',
    label: 'VIN Number',
    type: 'text',
    required: true,
    placeholder: '17 character VIN',
  },
  {
    id: 'engine_capacity',
    name: 'engineCapacity',
    label: 'Engine Capacity (cc)',
    type: 'number',
    required: true,
    placeholder: '2000',
    factorMultiplier: 1.2,
    factorCondition: 'value > 2500',
  },
];

const lifeInsuranceFields: ProductCustomField[] = [
  {
    id: 'smoker',
    name: 'smoker',
    label: 'Is Smoker',
    type: 'checkbox',
    required: false,
    factorMultiplier: 1.5,
    factorCondition: 'value === true',
  },
  {
    id: 'occupation',
    name: 'occupation',
    label: 'Occupation',
    type: 'select',
    required: true,
    options: ['Office Worker', 'Manual Labor', 'Healthcare', 'Education', 'Self-Employed', 'Retired', 'Other'],
    factorMultiplier: 1.3,
    factorCondition: 'value === "Manual Labor"',
  },
  {
    id: 'beneficiary_name',
    name: 'beneficiaryName',
    label: 'Beneficiary Name',
    type: 'text',
    required: true,
    placeholder: 'Full name of beneficiary',
  },
  {
    id: 'beneficiary_cnp',
    name: 'beneficiaryCnp',
    label: 'Beneficiary CNP',
    type: 'text',
    required: true,
    placeholder: '13 digit CNP',
  },
];

const healthInsuranceFields: ProductCustomField[] = [
  {
    id: 'pre_existing_conditions',
    name: 'preExistingConditions',
    label: 'Has Pre-existing Conditions',
    type: 'checkbox',
    required: false,
    factorMultiplier: 1.4,
    factorCondition: 'value === true',
  },
  {
    id: 'family_members',
    name: 'familyMembers',
    label: 'Number of Family Members',
    type: 'number',
    required: true,
    placeholder: '1',
  },
  {
    id: 'coverage_type',
    name: 'coverageType',
    label: 'Coverage Type',
    type: 'select',
    required: true,
    options: ['Basic', 'Standard', 'Premium', 'Comprehensive'],
    factorMultiplier: 1.5,
    factorCondition: 'value === "Comprehensive"',
  },
];

const travelInsuranceFields: ProductCustomField[] = [
  {
    id: 'destination',
    name: 'destination',
    label: 'Destination Country',
    type: 'text',
    required: true,
    placeholder: 'e.g., France',
  },
  {
    id: 'trip_duration',
    name: 'tripDuration',
    label: 'Trip Duration (days)',
    type: 'number',
    required: true,
    placeholder: '14',
  },
  {
    id: 'trip_type',
    name: 'tripType',
    label: 'Trip Type',
    type: 'select',
    required: true,
    options: ['Leisure', 'Business', 'Adventure Sports', 'Study'],
    factorMultiplier: 1.8,
    factorCondition: 'value === "Adventure Sports"',
  },
];

export const mockProducts: InsuranceProduct[] = [
  {
    id: 1,
    name: 'Premium Life Plan',
    code: 'PLP-001',
    description: 'Comprehensive life insurance with investment benefits',
    category: 'LIFE',
    insurerId: 1,
    insurerName: 'Allianz-Tiriac',
    basePremium: 150,
    baseRate: 0.003,
    active: true,
    customFields: lifeInsuranceFields,
  },
  {
    id: 2,
    name: 'Family Health Plus',
    code: 'FHP-001',
    description: 'Complete health coverage for the whole family',
    category: 'HEALTH',
    insurerId: 2,
    insurerName: 'Omniasig',
    basePremium: 300,
    baseRate: 0.025,
    active: true,
    customFields: healthInsuranceFields,
  },
  {
    id: 3,
    name: 'Auto Complete Coverage',
    code: 'ACC-001',
    description: 'Full auto insurance with roadside assistance',
    category: 'AUTO',
    insurerId: 3,
    insurerName: 'Groupama',
    basePremium: 100,
    baseRate: 0.04,
    active: true,
    customFields: autoInsuranceFields,
  },
  {
    id: 4,
    name: 'Home Secure Basic',
    code: 'HSB-001',
    description: 'Essential home protection coverage',
    category: 'HOME',
    insurerId: 4,
    insurerName: 'Euroins',
    basePremium: 80,
    baseRate: 0.002,
    active: true,
    customFields: homeInsuranceFields,
  },
  {
    id: 5,
    name: 'Travel Safe International',
    code: 'TSI-001',
    description: 'Worldwide travel insurance with medical coverage',
    category: 'TRAVEL',
    insurerId: 2,
    insurerName: 'Omniasig',
    basePremium: 50,
    baseRate: 0.015,
    active: true,
    customFields: travelInsuranceFields,
  },
];

export const mockBrokers: Broker[] = [
  {
    id: 1,
    firstName: 'Robert',
    lastName: 'Anderson',
    email: 'broker@insurebroker.com',
    phone: '+40 755-020-101',
    licenseNumber: 'BRK-2020-0001',
    commissionRate: 12.5,
    hireDate: '2020-03-15',
    active: true,
    userId: 3,
    role: 'BROKER',
  },
  {
    id: 2,
    firstName: 'Jennifer',
    lastName: 'Martinez',
    email: 'manager@insurebroker.com',
    phone: '+40 755-020-102',
    licenseNumber: 'BRK-2019-0042',
    commissionRate: 15.0,
    hireDate: '2019-08-22',
    active: true,
    userId: 2,
    role: 'BROKER_MANAGER',
  },
  {
    id: 3,
    firstName: 'Thomas',
    lastName: 'Lee',
    email: 't.lee@brokerage.com',
    phone: '+40 755-020-103',
    licenseNumber: 'BRK-2021-0015',
    commissionRate: 10.0,
    hireDate: '2021-01-10',
    active: true,
    userId: 4,
    role: 'BROKER',
  },
  {
    id: 4,
    firstName: 'Admin',
    lastName: 'User',
    email: 'admin@insurebroker.com',
    phone: '+40 755-020-100',
    licenseNumber: 'BRK-2018-0001',
    commissionRate: 20.0,
    hireDate: '2018-01-01',
    active: true,
    userId: 1,
    role: 'ADMINISTRATOR',
  },
];

export const mockPolicies: InsurancePolicy[] = [
  {
    id: 1,
    policyNumber: 'POL-2024-00001',
    clientId: 1,
    clientName: 'John Smith',
    productId: 1,
    productName: 'Premium Life Plan',
    insurerName: 'Allianz-Tiriac',
    brokerId: 1,
    brokerName: 'Robert Anderson',
    startDate: '2024-01-15',
    endDate: '2025-01-15',
    premium: 1800,
    sumInsured: 500000,
    status: 'ACTIVE',
    gdprConsent: true,
    gdprConsentDate: '2024-01-15',
    paymentMethod: 'CARD_ONLINE',
    paymentStatus: 'VALIDATED',
    createdAt: '2024-01-15',
    updatedAt: '2024-01-15',
  },
  {
    id: 2,
    policyNumber: 'POL-2024-00002',
    clientId: 2,
    clientName: 'Maria Popescu',
    productId: 2,
    productName: 'Family Health Plus',
    insurerName: 'Omniasig',
    brokerId: 2,
    brokerName: 'Jennifer Martinez',
    startDate: '2024-02-01',
    endDate: '2025-02-01',
    premium: 3600,
    sumInsured: 100000,
    status: 'ACTIVE',
    gdprConsent: true,
    gdprConsentDate: '2024-02-01',
    paymentMethod: 'BANK_TRANSFER',
    paymentStatus: 'VALIDATED',
    createdAt: '2024-02-01',
    updatedAt: '2024-02-01',
  },
  {
    id: 3,
    policyNumber: 'POL-2024-00003',
    clientId: 3,
    clientName: 'Andrei Ionescu',
    productId: 3,
    productName: 'Auto Complete Coverage',
    insurerName: 'Groupama',
    brokerId: 1,
    brokerName: 'Robert Anderson',
    startDate: '2024-01-20',
    endDate: '2025-01-20',
    premium: 1200,
    sumInsured: 50000,
    status: 'AWAITING_VALIDATION',
    gdprConsent: true,
    gdprConsentDate: '2024-01-20',
    paymentMethod: 'CASH',
    paymentStatus: 'PENDING',
    proofOfPayment: 'receipt_003.pdf',
    createdAt: '2024-01-20',
    updatedAt: '2024-01-20',
  },
  {
    id: 4,
    policyNumber: 'POL-2023-00045',
    clientId: 4,
    clientName: 'Elena Dumitrescu',
    productId: 4,
    productName: 'Home Secure Basic',
    insurerName: 'Euroins',
    brokerId: 3,
    brokerName: 'Thomas Lee',
    startDate: '2023-06-01',
    endDate: '2024-06-01',
    premium: 960,
    sumInsured: 300000,
    status: 'EXPIRED',
    gdprConsent: true,
    gdprConsentDate: '2023-06-01',
    paymentMethod: 'POS',
    paymentStatus: 'VALIDATED',
    createdAt: '2023-06-01',
    updatedAt: '2024-06-02',
  },
  {
    id: 5,
    policyNumber: 'POL-2024-00004',
    clientId: 5,
    clientName: 'Alexandru Gheorghe',
    productId: 5,
    productName: 'Travel Safe International',
    insurerName: 'Omniasig',
    brokerId: 2,
    brokerName: 'Jennifer Martinez',
    startDate: '2024-03-01',
    endDate: '2024-03-15',
    premium: 150,
    sumInsured: 25000,
    status: 'EXPIRED',
    gdprConsent: true,
    gdprConsentDate: '2024-03-01',
    paymentMethod: 'CARD_ONLINE',
    paymentStatus: 'VALIDATED',
    createdAt: '2024-03-01',
    updatedAt: '2024-03-16',
  },
  {
    id: 6,
    policyNumber: 'POL-2024-00005',
    clientId: 1,
    clientName: 'John Smith',
    productId: 3,
    productName: 'Auto Complete Coverage',
    insurerName: 'Groupama',
    brokerId: 1,
    brokerName: 'Robert Anderson',
    startDate: '2024-02-10',
    endDate: '2025-02-10',
    premium: 1200,
    sumInsured: 45000,
    status: 'AWAITING_PAYMENT',
    gdprConsent: true,
    gdprConsentDate: '2024-02-08',
    createdAt: '2024-02-08',
    updatedAt: '2024-02-08',
  },
];

export const mockCommissions: Commission[] = [
  {
    id: 1,
    policyId: 1,
    policyNumber: 'POL-2024-00001',
    brokerId: 1,
    brokerName: 'Robert Anderson',
    amount: 225,
    rate: 12.5,
    status: 'PAID',
    paymentDate: '2024-02-01',
    createdAt: '2024-01-15',
  },
  {
    id: 2,
    policyId: 2,
    policyNumber: 'POL-2024-00002',
    brokerId: 2,
    brokerName: 'Jennifer Martinez',
    amount: 540,
    rate: 15.0,
    status: 'PAID',
    paymentDate: '2024-03-01',
    createdAt: '2024-02-01',
  },
  {
    id: 3,
    policyId: 3,
    policyNumber: 'POL-2024-00003',
    brokerId: 1,
    brokerName: 'Robert Anderson',
    amount: 150,
    rate: 12.5,
    status: 'PENDING',
    paymentDate: null,
    createdAt: '2024-01-20',
  },
  {
    id: 4,
    policyId: 5,
    policyNumber: 'POL-2024-00004',
    brokerId: 2,
    brokerName: 'Jennifer Martinez',
    amount: 22.5,
    rate: 15.0,
    status: 'PAID',
    paymentDate: '2024-04-01',
    createdAt: '2024-03-01',
  },
];

export const mockRenewals: Renewal[] = [
  {
    id: 1,
    originalPolicyId: 4,
    newPolicyId: 0,
    policyNumber: 'POL-2023-00045',
    clientName: 'Elena Dumitrescu',
    renewalDate: '2024-06-01',
    previousPremium: 960,
    newPremium: 1020,
    status: 'PENDING',
    brokerId: 3,
  },
  {
    id: 2,
    originalPolicyId: 5,
    newPolicyId: 0,
    policyNumber: 'POL-2024-00004',
    clientName: 'Alexandru Gheorghe',
    renewalDate: '2024-03-15',
    previousPremium: 150,
    newPremium: 160,
    status: 'DECLINED',
    brokerId: 2,
  },
];

export const mockOffers: Offer[] = [
  {
    id: 1,
    offerNumber: 'OFR-2024-00001',
    clientId: 1,
    clientName: 'John Smith',
    productId: 2,
    productName: 'Family Health Plus',
    insurerName: 'Omniasig',
    brokerId: 1,
    brokerName: 'Robert Anderson',
    startDate: '2024-02-01',
    endDate: '2025-02-01',
    premium: 3600,
    sumInsured: 100000,
    status: 'PENDING',
    gdprConsent: true,
    gdprConsentDate: '2024-01-20',
    expiresAt: '2024-02-01',
    createdAt: '2024-01-20',
    updatedAt: '2024-01-20',
  },
  {
    id: 2,
    offerNumber: 'OFR-2024-00002',
    clientId: 3,
    clientName: 'Andrei Ionescu',
    productId: 4,
    productName: 'Home Secure Basic',
    insurerName: 'Euroins',
    brokerId: 1,
    brokerName: 'Robert Anderson',
    startDate: '2024-03-01',
    endDate: '2025-03-01',
    premium: 960,
    sumInsured: 300000,
    status: 'DRAFT',
    gdprConsent: false,
    expiresAt: '2024-03-01',
    createdAt: '2024-02-15',
    updatedAt: '2024-02-15',
  },
  {
    id: 3,
    offerNumber: 'OFR-2024-00003',
    clientId: 2,
    clientName: 'Maria Popescu',
    productId: 5,
    productName: 'Travel Safe International',
    insurerName: 'Omniasig',
    brokerId: 2,
    brokerName: 'Jennifer Martinez',
    startDate: '2024-04-01',
    endDate: '2024-04-15',
    premium: 150,
    sumInsured: 25000,
    status: 'PENDING',
    gdprConsent: true,
    gdprConsentDate: '2024-03-25',
    expiresAt: '2024-04-01',
    createdAt: '2024-03-25',
    updatedAt: '2024-03-25',
  },
];

export const mockDashboardStats: DashboardStats = {
  totalClients: 156,
  activePolicies: 89,
  totalPremium: 125000,
  pendingRenewals: 12,
  monthlyCommissions: 8500,
  expiringThisMonth: 8,
};

export const mockActivityLogs: ActivityLog[] = [
  {
    id: 1,
    entityType: 'POLICY',
    entityId: 1,
    activityType: 'POLICY_CREATED',
    description: 'Policy POL-2024-00001 created for John Smith',
    performedBy: 1,
    performedByName: 'Robert Anderson',
    createdAt: '2024-01-15T10:30:00Z',
  },
  {
    id: 2,
    entityType: 'CLIENT',
    entityId: 1,
    activityType: 'GDPR_SIGNED',
    description: 'GDPR consent signed',
    performedBy: 1,
    performedByName: 'Robert Anderson',
    createdAt: '2024-01-15T10:25:00Z',
  },
  {
    id: 3,
    entityType: 'POLICY',
    entityId: 1,
    activityType: 'PAYMENT_VALIDATED',
    description: 'Online card payment validated automatically',
    performedBy: 0,
    performedByName: 'System',
    createdAt: '2024-01-15T10:35:00Z',
  },
  {
    id: 4,
    entityType: 'CLIENT',
    entityId: 1,
    activityType: 'CLIENT_CREATED',
    description: 'Client John Smith created',
    performedBy: 1,
    performedByName: 'Robert Anderson',
    createdAt: '2024-01-15T10:00:00Z',
  },
];

export const mockNotifications: Notification[] = [
  {
    id: 1,
    type: 'POLICY_EXPIRING',
    title: 'Policy Expiring Soon',
    message: 'Policy POL-2024-00001 for John Smith expires in 30 days',
    read: false,
    userId: 1,
    relatedEntityType: 'POLICY',
    relatedEntityId: 1,
    createdAt: '2024-12-16T09:00:00Z',
  },
  {
    id: 2,
    type: 'PAYMENT_PENDING',
    title: 'Payment Awaiting Validation',
    message: 'Payment proof uploaded for POL-2024-00003 requires validation',
    read: false,
    userId: 2,
    relatedEntityType: 'POLICY',
    relatedEntityId: 3,
    createdAt: '2024-01-21T14:30:00Z',
  },
  {
    id: 3,
    type: 'COMMISSION_READY',
    title: 'Commission Ready',
    message: 'Your commission of $225 for POL-2024-00001 is ready for payment',
    read: true,
    userId: 1,
    relatedEntityType: 'COMMISSION',
    relatedEntityId: 1,
    createdAt: '2024-02-01T10:00:00Z',
  },
  {
    id: 4,
    type: 'NEW_OFFER',
    title: 'New Offer Created',
    message: 'Offer OFR-2024-00001 created for John Smith',
    read: true,
    userId: 1,
    relatedEntityType: 'OFFER',
    relatedEntityId: 1,
    createdAt: '2024-01-20T11:00:00Z',
  },
];

// Helper function to simulate backend premium calculation
export function calculatePremium(
  productId: number, 
  sumInsured: number, 
  customFieldValues: Record<string, unknown>
): { premium: number; breakdown: { basePremium: number; factors: Array<{ name: string; multiplier: number; reason: string }> } } {
  const product = mockProducts.find(p => p.id === productId);
  if (!product) {
    return { premium: 0, breakdown: { basePremium: 0, factors: [] } };
  }

  const basePremium = sumInsured * (product.baseRate || 0.01);
  const factors: Array<{ name: string; multiplier: number; reason: string }> = [];
  let totalMultiplier = 1;

  // Apply custom field factors
  if (product.customFields) {
    for (const field of product.customFields) {
      if (field.factorMultiplier && field.factorCondition) {
        const value = customFieldValues[field.name];
        let conditionMet = false;

        try {
          // Simple condition evaluation (in real backend, use proper expression parser)
          if (field.factorCondition.includes('===')) {
            const [, expected] = field.factorCondition.split('===').map(s => s.trim());
            conditionMet = String(value) === expected.replace(/['"]/g, '');
          } else if (field.factorCondition.includes('<')) {
            const [, threshold] = field.factorCondition.split('<').map(s => s.trim());
            conditionMet = Number(value) < Number(threshold);
          } else if (field.factorCondition.includes('>')) {
            const [, threshold] = field.factorCondition.split('>').map(s => s.trim());
            conditionMet = Number(value) > Number(threshold);
          }
        } catch {
          conditionMet = false;
        }

        if (conditionMet) {
          totalMultiplier *= field.factorMultiplier;
          factors.push({
            name: field.label,
            multiplier: field.factorMultiplier,
            reason: `${field.label}: ${value}`,
          });
        }
      }
    }
  }

  const finalPremium = Math.round(basePremium * totalMultiplier);

  return {
    premium: finalPremium,
    breakdown: {
      basePremium: Math.round(basePremium),
      factors,
    },
  };
}
